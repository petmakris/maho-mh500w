
loadusr -W xhc-hb04 -H -I xhc-hb04-layout2.cfg -s 1

# http://linuxcnc.org/docs/html/man/man1/xhc-hb04.1.html
# −h list command line options and exit 
# −I button−cfg−file (see below for file format) 
# −H run in real-time HAL mode (simulation mode is default) 
# −x wait for pendant detection before creating HAL pins

# −s n n is one of the following stepsize sequences
# 1: 1,10,100,1000 (default) 
# 2: 1,5,10,20 
# 3: 1,10,100 
# 4: 1,5,10,20,50,100 
# 5: 1,10,50,100,1000 
# The stepsize selected is always multiplied by 0.001

# ilowpass − Low-pass filter with integer inputs and outputs
# mult2 − Product of two inputs
# limit1 − Limit the output signal to fall between min and max

loadrt ilowpass count=1
loadrt mult2
loadrt limit1
addf ilowpass.0 servo-thread
addf mult2.0 servo-thread
addf limit1.0 servo-thread

# Absolute position LCD
net pos-x halui.axis.0.pos-feedback => xhc-hb04.x.pos-absolute
net pos-y halui.axis.1.pos-feedback => xhc-hb04.y.pos-absolute
net pos-z halui.axis.2.pos-feedback => xhc-hb04.z.pos-absolute
net pos-a halui.axis.3.pos-feedback => xhc-hb04.a.pos-absolute

# Relative position LCD
net pos-rel-x halui.axis.0.pos-relative => xhc-hb04.x.pos-relative
net pos-rel-y halui.axis.1.pos-relative => xhc-hb04.y.pos-relative
net pos-rel-z halui.axis.2.pos-relative => xhc-hb04.z.pos-relative
net pos-rel-a halui.axis.3.pos-relative => xhc-hb04.a.pos-relative

# Jog wheel and axis selection button
net jog-x axis.0.jog-enable <= xhc-hb04.jog.enable-x
net jog-y axis.1.jog-enable <= xhc-hb04.jog.enable-y
net jog-z axis.2.jog-enable <= xhc-hb04.jog.enable-z
net jog-a axis.3.jog-enable <= xhc-hb04.jog.enable-a
net xhcStepUp xhc-hb04.button-step => xhc-hb04.stepsize-up

# Lowpass Filtering for mpg
setp limit1.0.min 0.001
setp limit1.0.max 0.5
setp ilowpass.0.gain 0.01
# IMPORTANT to keep ratio ilowpass.0.scale mult2.0.in1
setp ilowpass.0.scale 1000
setp mult2.0.in1 0.001

net jog_scale_lim  <= xhc-hb04.jog.scale   => limit1.0.in 
net jog-counts_in  <=  xhc-hb04.jog.counts => ilowpass.0.in
net jog-counts_out <=  ilowpass.0.out      => axis.0.jog-counts axis.1.jog-counts axis.2.jog-counts axis.3.jog-counts
net jog-scale      <=  limit1.0.out        => mult2.0.in0
net scale_div_1000 <=  mult2.0.out         => axis.0.jog-scale axis.1.jog-scale axis.2.jog-scale axis.3.jog-scale 

# MDI-Auto Toggle
net tog_mode       <= xhc-hb04.button-mode => toggle.1.in
net tog_mode_out   <= toggle.1.out         => toggle2nist.1.in
net MDI-mode       => toggle2nist.1.is-on
net flip_to_mdi    <= toggle2nist.1.on     => halui.mode.mdi
net flip_to_manual <= toggle2nist.1.off    => halui.mode.manual



